FROM alpine:3

ARG ARGOCD_VERSION=v2.11.8

RUN apk update \
    && apk upgrade \
    && apk add wget bash \
    && wget https://github.com/argoproj/argo-cd/releases/download/${ARGOCD_VERSION}/argocd-linux-amd64 -O /usr/local/bin/argocd \
    && chmod a+x /usr/local/bin/argocd \
    && argocd version --client

COPY deploy_argocd_apps.bash /usr/local/bin/deploy_argocd_apps.bash
RUN chmod a+x /usr/local/bin/deploy_argocd_apps.bash

CMD ["deploy_argocd_apps.bash"]
